# 项目启动指南

## 环境准备

### 1. Python环境
- 确保已安装Python 3.7或更高版本
- 建议使用虚拟环境

### 2. Node.js环境
- 确保已安装Node.js 16.9.0或更高版本（推荐18+）
- 确保npm可用

## 快速启动

### 方法一：使用批处理脚本（推荐）

1. **启动后端服务**
   ```bash
   # 双击运行或在命令行执行
   start_backend.bat
   ```
   
2. **启动前端服务**
   ```bash
   # 双击运行或在命令行执行
   start_frontend.bat
   ```

### 方法二：手动启动

1. **启动后端服务**
   ```bash
   cd backend
   pip install -r requirements.txt
   python app.py
   ```

2. **启动前端服务**
   ```bash
   cd frontend
   npm install
   npm run dev
   ```

## 访问应用

### 本地访问
- 前端界面：`http://localhost:3000`
- 后端API：`http://localhost:8000`

### 内网访问
- 前端界面：`http://[你的IP地址]:3000`
- 后端API：`http://[你的IP地址]:8000`

## 实时同步功能

项目具备多终端实时同步功能：

- **消息同步**：每5秒自动刷新当前消息和历史记录
- **文件同步**：每10秒自动刷新文件列表
- **视频同步**：每10秒自动刷新视频列表

所有操作（发送消息、上传文件、删除文件等）都会立即触发刷新，确保多终端数据实时同步。

## 端口配置

### 修改端口
如果需要修改端口，请编辑以下文件：

**后端端口（默认8000）**
```python
# backend/app.py
app.run(host='0.0.0.0', port=8000, debug=True)
```

**前端端口（默认3000）**
```typescript
// frontend/vite.config.ts
server: {
  host: '0.0.0.0',
  port: 3000,
  // ...
}
```

### 修改轮询间隔
如需调整实时同步频率，可编辑以下文件：

**消息轮询间隔（默认5秒）**
```typescript
// frontend/src/components/MessagePanel.vue
pollInterval = window.setInterval(() => {
  load()
  loadHistory()
}, 5000) // 修改此数值
```

**文件轮询间隔（默认10秒）**
```typescript
// frontend/src/components/FilePanel.vue
pollInterval = window.setInterval(() => {
  load()
}, 10000) // 修改此数值
```

**视频轮询间隔（默认10秒）**
```typescript
// frontend/src/components/VideoPanel.vue
pollInterval = window.setInterval(() => {
  load()
}, 10000) // 修改此数值
```

## 常见问题

### 1. 端口被占用
**错误信息：** `Address already in use`

**解决方案：**
- 查找占用端口的进程：`netstat -ano | findstr :8000`
- 结束进程或修改端口配置

### 2. 依赖安装失败
**Python依赖：**
```bash
# 升级pip
python -m pip install --upgrade pip

# 使用国内镜像
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

**Node.js依赖：**
```bash
# 清除缓存
npm cache clean --force

# 使用国内镜像
npm config set registry https://registry.npmmirror.com
npm install
```

### 3. 前端无法连接后端
**检查项：**
1. 后端是否正常启动在8000端口
2. 防火墙是否阻止了端口访问
3. Vite代理配置是否正确

**解决方案：**
```bash
# 检查后端状态
curl http://localhost:8000/api/message/

# 检查防火墙
netsh advfirewall firewall add rule name="Backend Port" dir=in action=allow protocol=TCP localport=8000
netsh advfirewall firewall add rule name="Frontend Port" dir=in action=allow protocol=TCP localport=3000
```

### 4. 文件上传失败
**可能原因：**
- 文件大小超过限制（文件100MB，视频500MB）
- 文件格式不支持
- 磁盘空间不足

**解决方案：**
- 检查文件大小和格式
- 清理磁盘空间
- 查看后端日志

### 5. 消息/文件不同步
**可能原因：**
- 网络连接问题
- 轮询机制被阻止
- 浏览器缓存问题

**解决方案：**
- 检查网络连接
- 刷新浏览器页面
- 检查浏览器控制台是否有错误

### 6. Node.js版本兼容性
**推荐版本：** Node.js 18+

**如果使用Node.js 16：**
- 某些Vite功能可能受限
- 建议升级到Node.js 18+

## 开发模式

### 后端开发
```bash
cd backend
python app.py
# 启用debug模式，代码修改后自动重启
```

### 前端开发
```bash
cd frontend
npm run dev
# 启用热重载，代码修改后自动刷新
```

### 构建生产版本
```bash
cd frontend
npm run build
# 生成dist目录，包含生产版本文件
```

## 部署说明

### 开发环境
- 后端：Flask开发服务器
- 前端：Vite开发服务器
- 适合开发和测试

### 生产环境建议
- 后端：使用Gunicorn或uWSGI
- 前端：使用Nginx托管静态文件
- 配置反向代理
- 添加安全措施
- 考虑使用WebSocket替代轮询机制

## 日志查看

### 后端日志
后端日志会直接输出到控制台，包括：
- 请求日志
- 错误信息
- 文件操作日志

### 前端日志
前端日志在浏览器开发者工具中查看：
- 网络请求
- 控制台错误
- Vue组件状态

## 性能优化

### 文件上传优化
- 大文件建议分片上传
- 添加进度显示
- 支持断点续传

### 前端优化
- 启用gzip压缩
- 使用CDN加速
- 优化图片和视频加载

### 实时同步优化
- 考虑使用WebSocket替代轮询
- 实现增量更新
- 添加连接状态检测

## 安全建议

### 内网使用
- 当前版本适合内网环境
- 如需外网访问，请添加认证机制

### 文件安全
- 定期清理上传文件
- 限制文件类型和大小
- 扫描恶意文件

### 网络安全
- 配置防火墙规则
- 使用HTTPS（生产环境）
- 定期更新依赖包

### 实时同步安全
- 限制轮询频率
- 添加请求频率限制
- 监控异常访问 