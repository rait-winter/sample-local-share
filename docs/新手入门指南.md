# 内网共享工具新手入门指南

## 1. 这是什么？

这是一个让你在公司/学校/家里等局域网环境下，**快速分享文件、消息和视频**的小工具。你可以用它：
- 在多台电脑/手机之间互传文件、视频
- 发送和查看消息，像公告栏一样
- 不用U盘、不用网盘，速度快、安全、隐私本地可控

## 2. 我能用它做什么？
- 传大文件、视频给同事/同学/家人
- 共享会议资料、课件、图片、文档
- 发送临时通知、公告、留言
- 让手机和电脑互传照片/视频

## 3. 需要什么环境？
- 一台电脑（Windows，推荐Win10及以上）
- 安装了 Python 3.7+ 和 Node.js 16+
- 局域网内其他设备（手机/电脑）只需浏览器即可访问

## 4. 如何快速启动？
1. **下载并解压项目**
2. **安装依赖**
   - 后端：
     ```bash
     cd backend
     pip install -r requirements.txt
     ```
   - 前端：
     ```bash
     cd frontend
     npm install
     ```
3. **启动后端**
   ```bash
   cd backend
   python app.py
   ```
4. **启动前端**
   ```bash
   cd frontend
   npm run dev
   ```
   > 启动后会自动分配一个5位端口（如12345），终端会显示访问地址。
5. **用浏览器访问**
   - 在本机或同一局域网其他设备浏览器输入：
     ```
     http://本机IP:端口号
     例：http://192.168.1.100:12345
     ```

## 5. 界面和主要功能说明
- **顶部**：显示项目名称、访问地址（可一键复制）、设置按钮
- **消息管理**：输入消息，点击发送，所有人都能看到。历史消息可一键复制。
- **文件管理**：
  - 选择或拖拽文件上传
  - 支持图片/文档/压缩包等
  - 上传后自动显示在列表，可预览、下载、删除
- **视频管理**：
  - 选择或拖拽视频上传
  - 支持主流视频格式
  - 可在线播放、下载、删除
- **设置**：右上角"设置"按钮可调整每类内容的最大保留数量

## 6. 如何上传/下载/分享？
- **上传**：点击"选择文件/视频"或拖拽到上传区，点击"上传"
- **下载**：点击列表中的"下载"按钮即可
- **预览**：图片/文本/视频可直接预览
- **删除**：点击"删除"按钮，确认后即可删除
- **分享**：让对方在同一局域网下用浏览器访问你的本机IP+端口即可

## 7. 常见问题
- **Q: 为什么别人访问不了？**
  - A: 请确保你和对方在同一WiFi/局域网，且防火墙已放行前端显示的端口。
- **Q: 上传失败/太慢？**
  - A: 检查文件大小（文件≤100MB，视频≤500MB），建议用有线或5G WiFi。
- **Q: 端口不是3000/5173？**
  - A: 前端端口为随机分配（10000~65535），请以实际启动端口为准。
- **Q: 手机能访问吗？**
  - A: 可以，只要在同一局域网，手机浏览器输入电脑IP+端口即可。
- **Q: 如何保证安全？**
  - A: 所有数据只在本地和内网传输，不上传云端。可随时删除内容。

## 8. 注意事项
- 不建议用于公网或敏感数据传输
- 文件/视频/消息数量可在"设置"中调整，超出会自动清理最旧的
- 关闭前端服务后，端口会自动关闭（如未自动关闭可手动在防火墙设置）
- 如遇问题可重启前后端服务

## 9. FAQ
- **如何修改端口/自定义配置？**
  - 目前端口为随机分配，暂不支持手动指定
- **支持哪些文件/视频格式？**
  - 常见文档、图片、压缩包、主流视频格式均支持
- **如何升级/更新？**
  - 重新拉取代码，覆盖旧文件，重新安装依赖即可

---

## 10. 项目代码结构与调用关系

### 10.1 后端（Flask）
- **app.py**：主入口，注册API蓝图，启动服务。
- **api/message.py**：消息相关API（发送、获取、历史、最大条数设置）。
- **api/file.py**：文件相关API（上传、列表、下载、预览、删除、最大数量设置）。
- **api/video.py**：视频相关API（上传、列表、下载、预览、删除、最大数量设置）。
- **uploads/**、**videos/**：文件/视频实际存储目录。

**后端API调用流程示例：**
```python
# 发送消息
POST /api/message/ {"text": "你好"}
# 获取文件列表
GET /api/file/list
# 上传视频
POST /api/video/upload (multipart/form-data)
```

### 10.2 前端（Vue3 + Vite）
- **src/App.vue**：主页面，集成所有功能区和设置弹窗。
- **src/components/**：各功能区独立组件（如FilePanel、MessagePanel、VideoPanel、SettingsDialog）。
- **src/api/**：API封装（message.ts、file.ts、video.ts），所有前端请求都通过这些ts文件调用后端API。
- **src/main.ts**：Vue应用入口。

**前端调用关系示例：**
```ts
// 发送消息
import { sendMessage } from './api/message'
await sendMessage('你好')

// 上传文件
import { uploadFile } from './api/file'
await uploadFile(fileObj)

// 获取视频列表
import { listVideos } from './api/video'
const res = await listVideos()
console.log(res.data.videos)
```

**前端组件与API关系图：**
- App.vue
  - MessagePanel.vue  <->  api/message.ts
  - FilePanel.vue     <->  api/file.ts
  - VideoPanel.vue    <->  api/video.ts
  - SettingsDialog.vue <->  api/message.ts、api/file.ts、api/video.ts

### 10.3 典型前后端交互流程
1. 用户在前端点击"上传文件"
2. FilePanel.vue 调用 uploadFile（api/file.ts）
3. api/file.ts 发送POST请求到后端 /api/file/upload
4. 后端 file.py 处理上传、保存文件、返回结果
5. 前端收到响应，刷新文件列表

### 10.4 代码快速定位与调试建议
- 想改UI：看 App.vue 和 components/
- 想加/改API：看 backend/api/ 下对应py文件
- 想改数据结构：前后端api/目录下ts/py文件都要同步
- 想查调用流程：先看api/ts文件，再查py文件

### 10.5 典型功能完整代码片段

#### 发送消息（前端+后端）
**前端 src/api/message.ts**
```